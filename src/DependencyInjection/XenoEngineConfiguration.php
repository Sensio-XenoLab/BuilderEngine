<?php

namespace XenoLab\XenoEngine\DependencyInjection;

use Symfony\Component\Config\Definition\Builder\TreeBuilder;
use Symfony\Component\Config\Definition\ConfigurationInterface;

class XenoEngineConfiguration implements ConfigurationInterface
{
    public function getConfigTreeBuilder(): TreeBuilder
    {
        $treeBuilder = new TreeBuilder('xeno_engine');

        $treeBuilder->getRootNode()
            ->children()
                ->arrayNode('author_providers')
                    ->addDefaultsIfNotSet()
                    ->children()
                        ->arrayNode('articles')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->scalarNode('author_class')
                                    ->defaultValue(null)
                                ->end()
                                ->scalarNode('author_roles')
                                    ->defaultValue(null)
                                ->end()
                                ->scalarNode('author_placeholder')
                                    ->defaultValue('id')
                                    ->cannotBeEmpty()
                                ->end()
                            ->end()
                        ->end()
                        ->arrayNode('pages')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->scalarNode('author_class')
                                    ->defaultValue(null)
                                ->end()
                                ->scalarNode('author_roles')
                                    ->defaultValue(null)
                                ->end()
                                ->scalarNode('author_placeholder')
                                    ->defaultValue('id')
                                    ->cannotBeEmpty()
                                ->end()
                            ->end()
                        ->end()
                    ->end()
                ->end()
                ->arrayNode('library_config')
                    ->addDefaultsIfNotSet()
                    ->children()
                        ->scalarNode('driver')
                            ->defaultValue('local')
                            ->isRequired()
                            ->cannotBeEmpty()
                        ->end()
                        ->scalarNode('service')
                            ->defaultValue(null)
                        ->end()
                    ->end()
                ->end()
                ->scalarNode('mode')
                    ->defaultValue('default')
                    ->info('Possible values: default, form')
                    ->cannotBeEmpty()
                ->end()
                ->scalarNode('crud_prefix')
                    ->defaultValue('/admin')
                    ->info('Add a prefix to controllers URLs')
                ->end()
                ->arrayNode('actions')
                    ->addDefaultsIfNotSet()
                    ->info('Set granted roles to allow access to each actions like ["ROLE_USER"] for each controller.')
                    ->children()
                        ->arrayNode('categories')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->arrayNode('new')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('show')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('edit')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('delete')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                            ->end()
                        ->end()
                        ->arrayNode('articles')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->arrayNode('new')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('show')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('edit')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('delete')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                            ->end()
                        ->end()
                        ->arrayNode('pages')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->arrayNode('new')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('show')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('edit')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('delete')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                            ->end()
                        ->end()
                        ->arrayNode('navigations')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->arrayNode('new')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('show')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('edit')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('delete')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                            ->end()
                        ->end()
                        ->arrayNode('libraries')
                            ->addDefaultsIfNotSet()
                            ->children()
                                ->arrayNode('new')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('show')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('edit')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                                ->arrayNode('delete')
                                    ->addDefaultsIfNotSet()
                                    ->children()
                                        ->booleanNode('enabled')
                                            ->defaultValue(true)
                                            ->treatNullLike(true)
                                        ->end()
                                        ->scalarNode('roles')
                                            ->defaultValue([])
                                        ->end()
                                    ->end()
                                ->end()
                            ->end()
                        ->end()
                    ->end()
                ->end()
            ->end()
        ;

        return $treeBuilder;
    }
}
